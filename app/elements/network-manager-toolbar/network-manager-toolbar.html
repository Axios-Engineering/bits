<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../base-shared-styles/base-shared-styles.html">
<link rel="import" href="../network-manager-devices/network-manager-devices.html">

<dom-module id="network-manager-toolbar">
  <template>
    <style include="base-shared-styles">
    :host {
      display: block;
    }

    .main {
      position: relative;
    }
    </style>

    <network-manager-devices
      items="{{devices}}">
    </network-manager-devices>

    <span class="main">
      <iron-icon class="main" icon="[[computedIcon]]"></iron-icon>
    </span>

  </template>
  <script>
    (() => {
      'use strict';

      const DEVICE_TYPES = {
        ETHERNET: 1,
        BRIDGE: 13,
        WIFI: 2,
        CELLULAR: 8
      };

      Polymer({
        is: 'network-manager-toolbar',

        properties: {
          items: {
            type: Array,
            value: Array.from([]),
            readOnly: true
          },
          computedIcon: {
            type: String,
            computed: '_computeIconFromActiveConnection(devices.*)'
          }
        },

        _computeIconFromActiveConnection(deviceChanges) {
          let iconToReturn = 'device:signal-wifi-0-bar';
          let priorityConnection = -1;

          if (Array.isArray(this.devices)) {
            this.devices.filter((device) => device.AppliedConnection.length > 0)
            .map((device) => {
              if (device.DeviceType === DEVICE_TYPES.WIFI) {
                return 'notification:wifi';
              } else if (device.DeviceType === DEVICE_TYPES.ETHERNET && priorityConnection < 1) {
                iconToReturn = 'icons:swap-vert';
                priorityConnection = 1;
              } else if (device.DeviceType === DEVICE_TYPES.CELLULAR && priorityConnection < 0) {
                iconToReturn = 'device:network-cell';
                priorityConnection = 0;
              }
            });
          }

          return iconToReturn;
        }
      });
    })();
  </script>
</dom-module>
