<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../base-message-center/base-message-center-behavior.html">

<script>
  ((global) => {
    'use strict';

    const API_KEY = 'networkManager#interfaces#';

    function generateEventString(eventName) {
      return API_KEY + eventName;
    }

    const EVENTS = {
      UPDATE_INTERFACES: generateEventString('update-interfaces'),
      GET_INTERFACES: generateEventString('get-interfaces'),
      APPLY_BOND: generateEventString('apply-bond'),
    };

    Polymer({
      is: 'network-interfaces',

      behaviors: [
        /** @polymerBehavior BaseMessageCenterBehavior */
        global.Bits.BaseMessageCenterBehavior
      ],

      properties: {
        interfaces: {
          type: Array,
          notify: true,
        },
      },

      ready: function() {
        // Setup a listener so the server can push us device changes without us requesting
        return this.addSocketEventListener(EVENTS.UPDATE_INTERFACES, this._onInterfaces.bind(this))
          .then(() => this.addConnectRunnable(this.getInterfaces.bind(this)));
      },

      _onInterfaces: function(interfaces) {
        this.set('interfaces', interfaces);
      },

      getInterfaces: function() {
        return this.sendRequest(EVENTS.GET_INTERFACES)
          .then((interfaces) => this.set('interfaces', interfaces));
      },

      save: function(ifaceArray, setBondingEnabled) {
        if(setBondingEnabled === null || setBondingEnabled === undefined ) {
          setBondingEnabled = true;
        }
        const request = {ifaceArray: ifaceArray, setBondingEnabled: setBondingEnabled};
        return this.sendRequest(EVENTS.APPLY_BOND, request);
      },

    });
  })(this);
</script>
