<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<!--app-->
<link rel="import" href="../../../bower_components/font-roboto/roboto.html">
<link rel="import" href="../../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../../../bower_components/paper-toast/paper-toast.html">

<!--network-manager-->
<link rel="import" href="./cellular-config-card.html">
<link rel="import" href="./cellular-configs.html">

<dom-module id="cellular-page">

  <template>

    <style include="app-grid-style">

      :host{
        display: block;
        padding: 8px 8px 8px 8px;
        --app-grid-columns: 1;
        --app-grid-item-height: 625px;
        --app-grid-gutter: 8px;
      }

      #header {
        position: absolute;
        border-bottom: 1px solid lightgrey;
      }

      .app-grid {
        height: 100%;
        width: 100%;
        overflow-y: auto;
      }

      .toast-action {
        float: right;
        color:  white;
      }

      #toastSuccess {
        --paper-toast-color: lightblue;
      }

      #toastError {
        --paper-toast-color: orangered;
      }

      @media screen and (min-width: 930px) {
        :host {
          --app-grid-columns: 2;
        }
      }

      @media screen and (min-width: 1400px) {
        :host {
          --app-grid-columns: 3;
        }
      }

    </style>

    <!--Message center communication and data from the server-->
    <cellular-configs id="configs" configs="{{configs}}"> </cellular-configs>

    <app-header-layout has-scrolling-region fullbleed>
      <app-header id="header">
        <app-toolbar>
          <div main-title>Cellular Configuration</div>
        </app-toolbar>
      </app-header>


      <div class="app-grid" id="#cellularGrid">
        <template is="dom-repeat" items="{{configs}}" as="config">
          <cellular-config-card class="interface" config="{{config}}"></cellular-config-card>
        </template>
      </div>

    </app-header-layout>

    <paper-toast text="Success: changes applied." id="toastSuccess">
      <span class="toast-action" on-tap="_dismissSuccessToast">Dismiss</span>
    </paper-toast>

    <paper-toast text="Error! changes failed." id="toastError">
      <span class="toast-action" on-tap="_dismissErrorToast">Dismiss</span>
    </paper-toast>

  </template>

  <script>
    ((global) => {
      'use strict';

      const TAG = 'NETWORK_MGR:CELLULAR:CONFIG_APP';
      const debug = window.Bits.utils.getDebugger(TAG);

      const TOAST_DURATION_LONG = 5000;
      const TOAST_DURATION_SHORT = 2000;

      Polymer({

        is: 'cellular-page',

        behaviors: [
          Polymer.IronResizableBehavior
        ],

        listeners: {
          'save-cellular-config': '_onSave',
        },

        _onSave: function(e, cellularConfig) {
          // Save if we don't have any validation errors and not remotely editing
          return Promise.resolve()
            .then(() => this.$.configs.save(cellularConfig))
            .then(() => this._showSuccessToast(null, TOAST_DURATION_SHORT))
            .catch(() => {
              this._showErrorToast(null, TOAST_DURATION_LONG);
              return this.$.configs.getConfigs();
            });
        },

        _showSuccessToast(message, duration) {
          const properties = {
            duration: duration,
          };

          if(message) {
            properties.text = message;
          }

          this.$.toastSuccess.show(properties);
        },

        _showErrorToast(message, duration) {
          const properties = {
            duration: duration,
          };

          if(message) {
            properties.text = message;
          }

          this.$.toastError.show(properties);
        },

        _dismissErrorToast: function(e) {
          this.$.toastError.close();
        },

        _dismissSuccessToast: function(e) {
          this.$.toastSuccess.close();
        }

      }); // End Polymer

    })(this);
  </script>

</dom-module>
