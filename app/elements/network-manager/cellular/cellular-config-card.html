<link rel="import" href="../../../bower_components/polymer/polymer.html">

<!-- Iron Elements -->
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/hardware-icons.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<!-- Paper Elements -->
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">

<dom-module id="cellular-config-card">
  <style is="custom-style" include="iron-flex iron-flex-alignment iron-flex-factors">

    :host{
      display: block;
    }

    .interfaceToolbar {
      --paper-toolbar-background: white;
      --paper-toolbar-color: --dark-theme-text-color;
    }

    paper-toolbar.interfaceToolbar > ::content .title{
      margin-left: 8px;
    }

    .container {
      margin-bottom: 2%;
      margin-left: 10%;
      margin-right: 10%;
      @apply(--layout-flex);
    }

    .actions {
      @apply(--layout-horizontal);
      @apply(--layout-end-justified);
      padding: 8px 36px 16px 36px;
    }

    paper-card {
      width: 100%;
      height: 100%;
      @apply(--layout-vertical);
    }

    paper-toggle-button {
      padding: 8px 8px 4px 8px;
    }

  </style>

  <template>

    <paper-card>

      <!--Header for each interface-->
      <paper-toolbar class="interfaceToolbar">
        <div class="title">
          <iron-icon icon="hardware:developer-board"></iron-icon>
          <span>[[config.name]]</span>
        </div>
      </paper-toolbar>

      <div class="container">

        <div class="inputs">
          <paper-toggle-button checked="{{isDataEnabled}}">Cellular Data</paper-toggle-button>
          <paper-input id="inputApn"
                       label="APN"
                       value="{{selectedAPN}}"
                       hidden="{{!isDataEnabled}}">
          </paper-input>
        </div>

      </div>

      <div class="actions">
        <paper-icon-button disabled="{{!isChange}}" icon="icons:clear" on-tap="clear"></paper-icon-button>
        <paper-icon-button disabled="{{isApplyDisabled}}" icon="icons:save" on-tap="save"></paper-icon-button>
      </div>

    </paper-card>

  </template>

  <script src="/elements/network-manager/scripts/bundle.js"></script>
  <script>
    (function() {
      'use strict';

      const TAG = 'NETWORK_MGR:CELLULAR:CONFIG_CARD';
      const debug = window.Bits.utils.getDebugger(TAG);

      Polymer({

        is: 'cellular-config-card',

        //From the server
        properties: {
          config: {
            type: Object,
            notify: true,
            observer: '_observeConfig'
          },

          selectedAPN: {
            type: String,
            notify: true,
            observer: '_observeSelectedAPN'
          },

          isDataEnabled: {
            type: Boolean,
            notify: true,
            observer: '_observeIsDataEnabled'
          },

          isChange: {
            type: Boolean,
            value: false,
          },

          isApplyDisabled: {
            type: Boolean,
            computed: '_computeIsApplyDisabled(isChange)'
          }
        },

        _isNull(ref) {
          return (ref === undefined || ref === null);
        },

        _isAnyNull(refArray) {
          return refArray.some((ref) => this._isNull(ref));
        },

        _computeIsApplyDisabled: function(isChange) {
          return !isChange;
        },

        _initialize: function(config) {
          if(!this._isNull(config.isDataEnabled)) {
            this.set('isDataEnabled', config.isDataEnabled);
          }

          if(!this._isNull(config.apn)) {
            this.set('selectedAPN', config.apn);
          }
        },

        _observeConfig: function(newVal, oldVal) {
          if(oldVal === undefined) {
            this._initialize(newVal);
          }
        },

        _observeSelectedAPN: function(newVal, oldVal) {
          if(oldVal === undefined) {
            return;
          }
          this.set('isChange', true);
        },

        _observeIsDataEnabled: function(newVal, oldVal) {
          if(oldVal === undefined) {
            return;
          }
          this.set('isChange', true);
        },

        /**
         * Clear any client configs and set the config props to match the selected vals so
         * we can send it to the server
         **/
        finalize: function() {
          debug('finalize', this.config.name);
          this.config.isDataEnabled = this.isDataEnabled;

          if(this.isDataEnabled) {
            this.config.apn = this.selectedAPN;
          } else {
            this.config.apn = null;
            this.config.connection = null;
          }
        },

        clear: function() {
          this._initialize(this.config);
          this.set('isChange', false);
        },

        save: function() {
          this.finalize();
          this.fire('save-cellular-config', this.config);
        },

      });//End Polymer

    }());
  </script>

</dom-module>
