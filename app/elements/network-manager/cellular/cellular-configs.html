<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../base-message-center/base-message-center-behavior.html">

<script>
  ((global) => {
    'use strict';

    const API_KEY = 'networkManager#cellular#';

    function generateEventString(eventName) {
      return API_KEY + eventName;
    }

    const EVENTS = {
      UPDATE_CONFIGS: generateEventString('update-configs'),
      GET_CONFIGS: generateEventString('get-configs'),
      APPLY: generateEventString('apply'),
    };

    Polymer({
      is: 'cellular-configs',

      behaviors: [
        /** @polymerBehavior BaseMessageCenterBehavior */
        global.Bits.BaseMessageCenterBehavior
      ],

      properties: {
        configs: {
          type: Array,
          notify: true,
        },
      },

      ready: function() {
        // Setup a listener so the server can push us device changes without us requesting
        return this.addSocketEventListener(EVENTS.UPDATE_CONFIGS, this._onConfigs.bind(this))
          .then(() => this.addConnectRunnable(this.getConfigs.bind(this)));
      },

      _onConfigs: function(configs) {
        this.configs = configs;
      },

      getConfigs: function() {
        return this.sendRequest(EVENTS.GET_CONFIGS)
          .then((configs) => this.set('configs', configs));
      },

      save: function(config) {
        return this.sendRequest(EVENTS.APPLY, config);
      },

    });
  })(this);
</script>
